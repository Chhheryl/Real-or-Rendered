<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{{ lesson.title }}</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    {% include "nav-bar.html" %}
    <!-- PAGE WRAPPER -->
    <div class="page-wrapper">
      <!-- TOP ROW: Title + Next cue + Unlocked info -->
      <div class="lesson-toprow mb-3">
        <div>
          <h1 class="lesson-title">{{ lesson.title }}</h1>
          <div class="lesson-subtitle">{{ lesson.tip }}</div>
        </div>

        <div class="nav-right d-flex flex-column align-items-end">
          {% if next_id %}
          <a
            href="{{ url_for('learn', lesson_id=next_id) }}"
            class="btn-pink-nav mb-2"
          >
            ‚ñ∂ Next Cue: {{ lessons[next_id - 1].title }}
          </a>
          {% else %}
          <!-- If this is the last lesson, go to transition_learn_quiz -->
          <a href="{{ url_for('transition_learn_quiz') }}" class="btn-pink">
            Next ‚Üí
          </a>
          {% endif %}

          <div class="unlocked-info">
            üîì You‚Äôve unlocked: {{ lesson.id }}/5 cues
          </div>
        </div>
      </div>

      <div class="hover-hint mb-2 text-center">
        *Hover on the image to view sketchy areas
      </div>

      <!-- ARTWORK ROW: AI vs Human -->
      <div class="artwork-row">
        <!-- LEFT: AI Artwork -->
        <div class="artwork-col">
          <div class="image-container">
            <img
              src="{{ url_for('static', filename='images/' + lesson.images.ai) }}"
              class="img-fluid"
              alt="AI-generated artwork"
            />
            {% for spot in lesson.hotspots %}
            <div
              class="hotspot"
              style="top: {{ spot.y_pct }}%; left: {{ spot.x_pct }}%;"
              data-label="{{ spot.label }}"
              data-zoom-ai="{{ url_for('static', filename='images/' + spot.zoom_ai) }}"
              data-zoom-real="{{ url_for('static', filename='images/' + spot.zoom_real) }}"
              data-explanation="{{ spot.explanation }}"
            ></div>
            {% endfor %}
          </div>
          <div class="artwork-caption">{{ lesson.captions.ai }}</div>
          <div class="artwork-label">AI-generated</div>
        </div>

        <!-- RIGHT: Human Artwork -->
        <div class="artwork-col">
          <img
            src="{{ url_for('static', filename='images/' + lesson.images.real) }}"
            class="img-fluid"
            alt="Human-made artwork"
          />
          <div class="artwork-caption">{{ lesson.captions.real }}</div>
          <div class="artwork-label">Human-made</div>
        </div>
      </div>

      <!-- QUICK TIP (optional) -->
      {% if lesson.quick_tip %}
      <div class="quick-tip">
        <strong>üí° Quick tip:</strong> {{ lesson.quick_tip }}
      </div>
      {% endif %}

      <!-- BOTTOM NAVIGATION -->
      <div class="bottom-nav">
        <div class="nav-left">
          <a href="{{ url_for('home') }}" class="btn-tan-nav">Back to üè†Home</a>
          <a href="{{ url_for('transition') }}" class="btn-tan-nav"
            >Back to üìñOverview</a
          >
        </div>
      </div>
    </div>

    <!-- ZOOM MODAL -->
    <div class="modal fade" id="zoomModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div>
          <div class="modal-header">
            <h5 class="modal-title">Hotspot Details</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              id="btnClosePanel"
            ></button>
          </div>
          <div class="modal-body">
            <p id="modal-explanation"></p>
            <div class="row">
              <div class="col-md-6 text-center">
                <h6>AI</h6>
                <img id="modal-ai" class="img-fluid" />
              </div>
              <div class="col-md-6 text-center">
                <h6>Human</h6>
                <img id="modal-real" class="img-fluid" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- BOOTSTRAP + HOTSPOT SCRIPT -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const btnClosePanel = document.getElementById("btnClosePanel");
      if (btnClosePanel) {
        btnClosePanel.addEventListener("click", () => {
          console.log("Modal manually closed via button");
        });
      }

      // On hotspot click
      document.querySelectorAll(".hotspot").forEach((spot) => {
        spot.addEventListener("click", () => {
          // Populate modal content
          const label = spot.getAttribute("data-label");
          const aiImg = spot.getAttribute("data-zoom-ai");
          const realImg = spot.getAttribute("data-zoom-real");
          const explanation = spot.getAttribute("data-explanation");

          document.querySelector(".modal-title").textContent = label;
          document.getElementById("modal-ai").src = aiImg;
          document.getElementById("modal-real").src = realImg;
          document.getElementById("modal-explanation").textContent =
            explanation;

          // Show modal
          new bootstrap.Modal(document.getElementById("zoomModal")).show();

          // Add 'visited' class to turn hotspot green
          spot.classList.add("visited");
        });
      });
    </script>
  </body>
</html>
